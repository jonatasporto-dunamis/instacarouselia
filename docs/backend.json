{
  "entities": {
    "Carousel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Carousel",
      "type": "object",
      "description": "Represents an Instagram carousel generated by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the carousel."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this carousel."
        },
        "topic": {
          "type": "string",
          "description": "The topic used to generate the carousel."
        },
        "slideIds": {
          "type": "array",
          "description": "References to Slide entities in this carousel. (Relationship: Carousel 1:N Slide)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the carousel was created.",
          "format": "date-time"
        },
        "lastModified": {
          "type": "string",
          "description": "Timestamp indicating when the carousel was last modified.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "topic",
        "slideIds",
        "createdAt",
        "lastModified"
      ]
    },
    "Slide": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Slide",
      "type": "object",
      "description": "Represents a single slide within a carousel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the slide."
        },
        "carouselId": {
          "type": "string",
          "description": "Reference to Carousel. (Relationship: Carousel 1:N Slide)"
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this slide."
        },
        "content": {
          "type": "string",
          "description": "The text content of the slide."
        },
        "layout": {
          "type": "string",
          "description": "The layout configuration for the slide (e.g., image placement, text arrangement).  Could store a JSON structure here representing the layout."
        },
        "order": {
          "type": "number",
          "description": "The order of the slide within the carousel."
        }
      },
      "required": [
        "id",
        "carouselId",
        "userId",
        "content",
        "layout",
        "order"
      ]
    },
    "InstagramProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Instagram Profile",
      "type": "object",
      "description": "Stores connected Instagram profile data for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier (can be the user's ID)."
        },
        "instagramUserId": {
          "type": "string",
          "description": "The user's Instagram account ID from the Meta API."
        },
        "accessToken": {
          "type": "string",
          "description": "Encrypted long-lived access token for the Meta Graph API."
        },
        "tokenExpiresAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp for when the access token expires."
        },
        "username": {
          "type": "string",
          "description": "The Instagram username."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the Instagram profile picture."
        },
        "lastSynced": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the last successful data sync."
        }
      },
      "required": [
        "id",
        "instagramUserId",
        "accessToken",
        "username"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/carousels/{carouselId}",
        "definition": {
          "entityName": "Carousel",
          "schema": {
            "$ref": "#/backend/entities/Carousel"
          },
          "description": "Stores carousels created by a user. Path-based ownership ensures only the user can access their carousels.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the carousel."
            },
            {
              "name": "carouselId",
              "description": "The unique ID of the carousel."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/carousels/{carouselId}/slides/{slideId}",
        "definition": {
          "entityName": "Slide",
          "schema": {
            "$ref": "#/backend/entities/Slide"
          },
          "description": "Stores slides belonging to a specific carousel. Path-based ownership ensures only the owning user can access these slides.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the carousel and slides."
            },
            {
              "name": "carouselId",
              "description": "The ID of the carousel to which the slide belongs."
            },
            {
              "name": "slideId",
              "description": "The unique ID of the slide."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/instagramProfile/{profileId}",
        "definition": {
          "entityName": "InstagramProfile",
          "schema": {
            "$ref": "#/backend/entities/InstagramProfile"
          },
          "description": "Stores the connected Instagram profile for a user. Path-based ownership ensures only the user can access their connection data.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the profile data."
            },
            {
              "name": "profileId",
              "description": "Should typically be the same as userId for a 1:1 relationship."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage Instagram carousels and user profile data. Each user can create and manage their carousels and slides, with a clear ownership model. The addition of the `InstagramProfile` entity under a user's document allows for secure storage of API tokens and synced data, maintaining the principle of user-owned data. Authorization Independence is achieved by storing all user-specific data (carousels, slides, Instagram profile) in subcollections under the user's main document, ensuring that a user can only ever access their own information. This structure supports the application's QAPs by scoping data access strictly to the authenticated user, preventing data leakage and simplifying security rules."
  }
}